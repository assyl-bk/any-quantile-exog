model:
  _target_: model.AnyQuantileForecasterResidualHierarchical
  
  nn:
    backbone:
      _target_: modules.NBEATSAQFILM  # Use best variant (FiLM)
      num_blocks: 30      # CRITICAL: Keep all 30 blocks
      num_layers: 3       # Paper's value
      layer_width: 1024   # Paper's value
      share: false
      size_in: 168
      size_out: 48
      dropout: 0.0        # Paper's value
      quantile_embed_dim: 64
      quantile_embed_num: 100
  
  input_horizon_len: 168
  
  loss:
    _target_: losses.MQNLoss  # Normalized pinball loss
  
  # Quantile sampling
  q_sampling: random_in_batch
  q_distribution: uniform  # Start with uniform for stability
  q_parameter: 0.3  # Only used if beta
  
  max_norm: true
  
  # Training quantiles
  num_train_quantiles: 9  # Sample 9 quantiles per batch
  
  # Optimizer - EXACTLY as paper baseline
  optimizer:
    _target_: torch.optim.Adam
    lr: 0.0005          # Paper's value
    weight_decay: 0.0   # Paper's value (NO regularization)
  
  scheduler:
    _target_: schedulers.InverseSquareRoot
    warmup_updates: 400
    warmup_end_lr: 0.0005

dataset:
  _target_: dataset.ElectricityUnivariateDataModule
  name: MHLV
  train_batch_size: 1024  # Paper's value
  eval_batch_size: 1024
  num_workers: 4
  persistent_workers: true
  split_boundaries: ['2006-01-01', '2017-01-01', '2018-01-01', '2019-01-01']
  history_length: 168
  horizon_length: 48
  fillna: 'ffill'
  train_step: 24      # Paper's value
  eval_step: 24

trainer:
  max_epochs: 15      # Paper's value
  check_val_every_n_epoch: 1
  log_every_n_steps: 50
  devices: 1
  accelerator: gpu
  precision: 32
  gradient_clip_val: 1.0  # Paper's value

logging:
  path: lightning_logs
  name: nbeatsaq-residual-hierarchical

checkpoint:
  save_top_k: 5
  monitor: val/crps
  mode: min
  ckpt_path: null
  resume_ckpt: null

random.seed: !!python/tuple [0,1,2,3,4,5,6,7]

# EXPECTED RESULTS:
# CRPS: 190-210 (target: < 211)
# Coverage: 0.950-0.960
# Alpha: Should stabilize around 0.05-0.15 (5-15% hierarchical)
#
# MONITORING:
# - Watch train/alpha: should stay low (0.05-0.15)
# - If alpha > 0.3, hierarchical is taking over (risky!)
# - If val/crps > 220 after epoch 5, stop and use lightweight version